<div class="clr-row">
    <div class="clr-col-12">
        <h4>{{ scenario.name | atob }}</h4>
    </div>
    <div class="clr-col-12">
        <div class="progress labeled success">
            <progress max="100" [value]="getProgress() || 0" data-displayval="0%"></progress>
            <span>{{getProgress()}}%</span>
        </div>
    </div>
</div>
<div class="clr-row">
    <div class="clr-col-4">
        <div class="card">
            <div class="card-block">
                <h4 class="card-title">{{ step.title | atob }}</h4>
                <div class="card-text">
                    <dynamic-html [content]="step.content | atob | markdown"></dynamic-html>
                    <!-- <markdown ngPreserveWhitespaces [data]="step.content | atob" #markdown></markdown> -->
                </div>
            </div>
            <div class="card-footer">
                <button class="btn btn-outline btn-previous" (click)="goPrevious()"
                    [class.disabled]="this.stepnumber == 0">
                    <clr-icon shape="arrow" dir="left"></clr-icon> Previous
                </button>
                <button class="btn btn-outline btn-next" *ngIf="(this.scenario.stepcount-1) > this.stepnumber"
                    (click)="goNext()">Next <clr-icon shape="arrow" dir="right"></clr-icon></button>
                <button class="btn btn-success btn-next" *ngIf="(this.scenario.stepcount-1) == this.stepnumber"
                    (click)="goFinish()">Finish <clr-icon shape="check"></clr-icon></button>
            </div>
        </div>
    </div>
    <div class="clr-col-8">
        <clr-tabs class="terminals">
            <clr-tab>
                <button clrTabLink>
                    <clr-icon size="24" shape="unknown-status"></clr-icon> Info
                </button>
                <clr-tab-content>
                    Use the tabs to navigate between shell sessions on your provisioned VMs.
                </clr-tab-content>
            </clr-tab>
            <clr-tab *ngFor="let v of vmclaimvms | keyvalue" #tab>
                <button clrTabLink [id]="v.key">
                    <clr-icon size="24" shape="host"></clr-icon> {{ v.key }}
                </button>
                <clr-tab-content #tabcontent>
                    <table class="table compact">
                        <tr>
                            <td><b>Status:</b> {{ getVm(v.value.vm_id)?.status }}</td>
                            <td><b>Public IP:</b> {{ getVm(v.value.vm_id)?.public_ip }}</td>
                            <td><b>Private IP:</b> {{ getVm(v.value.vm_id)?.private_ip }}</td>
                            <td><b>Hostname:</b> {{ getVm(v.value.vm_id)?.hostname }}</td>
                        </tr>
                    </table>
                    <terminal [vmname]="v.key" [vmid]="v.value.vm_id" [endpoint]="getVm(v.value.vm_id).ws_endpoint" #term></terminal>
                </clr-tab-content>
            </clr-tab>
        </clr-tabs>
    </div>
</div>

<clr-modal [(clrModalOpen)]="finishOpen">
    <h3 class="modal-title">
        Are you sure you want to finish?
    </h3>
    <div class="modal-body">
        <p>
            Finishing a scenario will immediately de-provision your resources. Any VMs that you are using will be wiped. 
        </p>
    </div>
    <div class="modal-footer">
        <button class="btn btn-outline" (click)="finishOpen = false">Cancel</button>
        <button class="btn btn-danger-outline" (click)="actuallyFinish()">Finish</button>
    </div>
</clr-modal>